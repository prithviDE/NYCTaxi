{
	"name": "01-Create DW Tables",
	"properties": {
		"content": {
			"query": "Create Schema Dim\n\nCreate Schema Fact \n\nCREATE TABLE Dim.TaxiZones\n\t(\n\t [LocationID] bigint,\n\t [Borough] nvarchar(400),\n\t [Zone] nvarchar(400),\n\t [service_zone] nvarchar(400)\n\t)\n\tWITH\n\t(\n\tDISTRIBUTION = ROUND_ROBIN,\n\t CLUSTERED COLUMNSTORE INDEX\n\t)\n\nGO\n\nCREATE TABLE [Dim].[PaymentType] \n\n( \n\nPaymentID INT NOT NULL,\n\nPaymentType NVARCHAR(20)\n) \n\nWITH \n( \n    DISTRIBUTION = Replicate,\n    CLUSTERED COLUMNSTORE INDEX\n)\n\n\nCreate Table Dim.FHvBases\n(\n    BaseLicenseId Varchar(50),\n    BaseType Varchar(50),\n    AddressBuilding Varchar(100),\n    AddressStreet Varchar(100),\n    AddressCity Varchar(100),\n    AddressState Varchar(100), \n    AddressPostalCode Varchar(10)\n)\n\n\n\n---Alter table with BaseLicenseId\nCREATE TABLE [Fact].[TripDetails]\n(\n\t[VendorId] [int] NULL,\n\t[TransactionKey] [varchar](50) NULL,\n\t[PickupTime] [datetime2](7) NULL,\n\t[DropTime] [datetime2](7) NULL,\n\t[PassangerCount] [int] NULL,\n\t[TripDistance] [float] NULL,\n\t[RateCodeId] [int] NULL,\n\t[PickupLocationId] [int] NULL,\n\t[DropLocationId] [int] NULL,\n\t[PaymentTypeId] [int] NULL,\n\t[TotalAmount] [float] NULL,\n\t[TipAmount] [float] NULL,\n\t[TripYear] [varchar](4) NULL,\n\t[TripMonth] [varchar](2) NULL,\n\t[TripDay] [varchar](2) NULL,\n\t[Fhv_flag] [int] NULL,\n\t[FhvBusinessID] [varchar](10) NULL,\n\t[Fhv_BaseLicenceId] [Varchar](50) null\n)\nWITH\n(\n\tDISTRIBUTION = ROUND_ROBIN,\n\tCLUSTERED COLUMNSTORE INDEX\n)\n\nCREATE TABLE RateCodes\n(\n\tRateCodeId INT,\n\tRateCode VARCHAR(100),\n\tIsApproved BIT\n)\n\n\nCREATE TABLE [dbo].[Vendor](\n\t[VendorID] [int] NULL,\n\t[Vendor_name] [nvarchar](50) NULL\n)\n\nCREATE TABLE Dim.Business\n(\n\tBusinessId nvarchar(10) Not Null,\n\tBusiness_Type nvarchar(20)\n\n)\nWITH(DISTRIBUTION = REPLICATE,\n\tHEAP)\n\n\nINSERT INTO RateCodes (RateCodeId, RateCode, IsApproved)\nVALUES\n(1, 'Standard Rate', 1),\n(2, 'JFK', 1),\n(3, 'Newark', 1),\n(4, 'Westchester', 0),\n(5, 'Negotiated fare', 1),\n(6, 'GroupRide', 1)\n\n\n\nINSERT INTO Vendor VALUES(1,'Creative Mobile Technologies,LLC'),\n(2,'VeriFone Inc')\n\n\nINSERT INTO BUSINESS VALUES('HV0002','Juno'),\n('HV0003','Uber'),\n('HV0004', 'Via'),\n('HV0005', 'Lyft')\n\n\n\n\n\n\n/****** Object:  StoredProcedure [dbo].[bulk_load_TaxiZones]    Script Date: 24-08-2022 15:27:27 ******/\nSET ANSI_NULLS ON\nGO\n\nSET QUOTED_IDENTIFIER ON\nGO\n\nALTER PROC [dbo].[bulk_load_TaxiZones] AS\nBEGIN\n\nIF NOT EXISTS (SELECT * FROM sys.objects O JOIN sys.schemas S ON O.schema_id = S.schema_id WHERE O.NAME = 'TaxiZones' AND O.TYPE = 'U' AND S.NAME = 'dbo')\nCREATE TABLE Dim.TaxiZones\n\t(\n\t [LocationID] bigint,\n\t [Borough] nvarchar(400),\n\t [Zone] nvarchar(400),\n\t [service_zone] nvarchar(400)\n\t)\nWITH\n\t(\n\tDISTRIBUTION = ROUND_ROBIN,\n\t CLUSTERED COLUMNSTORE INDEX\n\t -- HEAP\n\t)\n\nELSE\n\tTRUNCATE TABLE Dim.TaxiZones\n\n--Uncomment the 4 lines below to create a stored procedure for data pipeline orchestrationâ€‹\n--CREATE PROC bulk_load_TaxiZones\n--AS\n--BEGIN\nCOPY INTO DIM.TaxiZones\n(LocationID 1, Borough 2, Zone 3, service_zone 4)\nFROM 'https://dssavdprojdatalake.dfs.core.windows.net/taxidataraw/TaxiZones'\nWITH\n(\n\tFILE_TYPE = 'CSV'\n\t,MAXERRORS = 10\n\t,FIRSTROW = 2\n\t,ERRORFILE = 'https://dssavdprojdatalake.dfs.core.windows.net/taxidataraw/Errors/'\n)\nEND\nGO\n\n\n\n\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "SQLPool1",
				"poolName": "SQLPool1"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}